<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°ä¸‹åŸæ¢é™©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Microsoft YaHei', sans-serif;
            padding: 10px;
            user-select: none;
        }

        h1 { color: #fff; font-size: 1.6rem; margin-bottom: 8px; }

        .info-bar { display: flex; gap: 10px; margin-bottom: 8px; flex-wrap: wrap; justify-content: center; }
        .info-item { background: rgba(255,255,255,0.15); padding: 5px 12px; border-radius: 12px; color: #fff; font-size: 0.85rem; }

        .game-area { display: flex; gap: 10px; }

        #gameCanvas { background: #0a0a15; border-radius: 10px; }

        .sidebar { display: flex; flex-direction: column; gap: 8px; }

        .action-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .action-btn:hover { transform: scale(1.02); }
        .attack-btn { background: #e74c3c; color: #fff; }
        .item-btn { background: #f39c12; color: #fff; }
        .run-btn { background: #95a5a6; color: #fff; }

        .stats-panel {
            background: #1e1e3f;
            border-radius: 10px;
            padding: 10px;
            color: #fff;
            min-width: 120px;
        }

        .player-hp { color: #e74c3c; font-weight: bold; }
        .player-hp-bar {
            height: 8px; background: #333; border-radius: 4px; overflow: hidden; margin-top: 3px;
        }
        .player-hp-fill { height: 100%; background: #e74c3c; transition: width 0.3s; }

        .enemy-panel {
            background: #2d1f1f;
            border-radius: 10px;
            padding: 10px;
            color: #fff;
            margin-top: 8px;
        }

        .enemy-hp { color: #e74c3c; }
        .enemy-hp-bar { height: 6px; background: #333; border-radius: 3px; overflow: hidden; margin-top: 3px; }
        .enemy-hp-fill { height: 100%; background: #e74c3c; transition: width 0.3s; }

        .log {
            background: #111;
            border-radius: 8px;
            padding: 8px;
            margin-top: 8px;
            max-height: 80px;
            overflow-y: auto;
            font-size: 0.75rem;
            color: #aaa;
        }

        .log-entry { margin: 3px 0; }
        .log-entry.damage { color: #e74c3c; }
        .log-entry.heal { color: #27ae60; }
        .log-entry.win { color: #f1c40f; }
        .log-entry.lose { color: #95a5a6; }
    </style>
</head>
<body>
    <h1>âš”ï¸ åœ°ä¸‹åŸæ¢é™©</h1>

    <div class="info-bar">
        <div class="info-item">ğŸ° æ¥¼å±‚: <span id="floor">1</span></div>
        <div class="info-item">ğŸ’° é‡‘å¸: <span id="money">0</span></div>
        <div class="info-item">ğŸ’ è¯æ°´: <span id="potions">2</span></div>
    </div>

    <div class="game-area">
        <canvas id="gameCanvas" width="280" height="320"></canvas>
        <div class="sidebar">
            <button class="action-btn attack-btn" onclick="attack()">âš”ï¸ æ”»å‡»</button>
            <button class="action-btn item-btn" onclick="usePotion()">ğŸ§ª è¯æ°´</button>
            <button class="action-btn run-btn" onclick="tryRun()">ğŸƒ é€ƒè·‘</button>

            <div class="stats-panel">
                <div>ğŸ‘¤ å‹‡è€…</div>
                <div class="player-hp">â¤ï¸ <span id="hp">100</span>/<span id="maxHp">100</span></div>
                <div class="player-hp-bar"><div class="player-hp-fill" id="hpBar" style="width:100%"></div></div>
                <div style="margin-top:5px;">âš”ï¸ <span id="attack">10</span> | ğŸ›¡ï¸ <span id="defense">0</span></div>
            </div>

            <div class="enemy-panel" id="enemyPanel" style="display:none;">
                <div>ğŸ‘¹ <span id="enemyName">å²è±å§†</span></div>
                <div class="enemy-hp">â¤ï¸ <span id="enemyHp">30</span>/<span id="enemyMaxHp">30</span></div>
                <div class="enemy-hp-bar"><div class="enemy-hp-fill" id="enemyHpBar" style="width:100%"></div></div>
            </div>

            <div class="log" id="log"></div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const enemies = [
            {emoji:'ğŸŸ¢',name:'å²è±å§†',hp:30,attack:5,reward:10},
            {emoji:'ğŸ¦‡',name:'è™è ',hp:25,attack:8,reward:15},
            {emoji:'ğŸ•·ï¸',name:'èœ˜è››',hp:40,attack:10,reward:20},
            {emoji:'ğŸ’€',name:'éª·é«…',hp:50,attack:12,reward:25},
            {emoji:'ğŸ‘¹',name:'ç‰›å¤´äºº',hp:80,attack:15,reward:40},
            {emoji:'ğŸ‰',name:'å·¨é¾™',hp:150,attack:25,reward:100}
        ];

        let player = {hp:100, maxHp:100, attack:10, defense:0, money:0, potions:2, floor:1};
        let enemy = null;

        function draw(){
            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0,0,canvas.width,canvas.height);

            // åœ°æ¿
            ctx.fillStyle = '#1a1a2e';
            for(let y=0;y<8;y++){
                for(let x=0;x<7;x++){
                    if((x+y)%2===0) ctx.fillRect(x*40,y*40,40,40);
                }
            }

            // ç©å®¶
            ctx.font = '2rem';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ§™', 140, 180);

            // æ•Œäºº
            if(enemy){
                ctx.fillText(enemy.emoji, 140, 80);
            }

            // æ¥¼å±‚èƒŒæ™¯
            ctx.fillStyle = 'rgba(255,255,255,0.1)';
            ctx.font = '8rem';
            ctx.textAlign = 'center';
            ctx.fillText(player.floor, 140, 200);
        }

        function spawnEnemy(){
            const index = Math.min(Math.floor((player.floor-1)/2), enemies.length-1);
            enemy = {...enemies[index]};
            enemy.maxHp = enemy.hp;
            updateEnemyUI();
            document.getElementById('enemyPanel').style.display = 'block';
            log(`é‡åˆ°äº† ${enemy.emoji}${enemy.name}ï¼`);
            draw();
        }

        function attack(){
            if(!enemy) return;

            const damage = Math.max(1, player.attack);
            enemy.hp -= damage;
            log(`æ”»å‡»ï¼é€ æˆ ${damage} ä¼¤å®³`);

            if(enemy.hp <= 0){
                winBattle();
            }else{
                enemyAttack();
            }
            updateEnemyUI();
        }

        function enemyAttack(){
            const damage = Math.max(1, enemy.attack - player.defense);
            player.hp -= damage;
            log(`${enemy.name} æ”»å‡»ï¼å—åˆ° ${damage} ä¼¤å®³`, 'damage');

            if(player.hp <= 0){
                gameOver();
            }
            updatePlayerUI();
        }

        function usePotion(){
            if(player.potions <= 0){
                log('æ²¡æœ‰è¯æ°´äº†ï¼');
                return;
            }
            if(player.hp >= player.maxHp){
                log('ç”Ÿå‘½å€¼å·²æ»¡ï¼');
                return;
            }

            player.potions--;
            player.hp = Math.min(player.maxHp, player.hp + 50);
            log('ä½¿ç”¨è¯æ°´ï¼Œæ¢å¤ 50 ç”Ÿå‘½ï¼', 'heal');
            enemyAttack();
            updatePlayerUI();
        }

        function tryRun(){
            if(!enemy) return;
            if(Math.random() < 0.5){
                log('é€ƒè·‘æˆåŠŸï¼', 'lose');
                enemy = null;
                document.getElementById('enemyPanel').style.display = 'none';
                player.floor++;
                updatePlayerUI();
                draw();
            }else{
                log('é€ƒè·‘å¤±è´¥ï¼', 'lose');
                enemyAttack();
            }
        }

        function winBattle(){
            player.money += enemy.reward;
            log(`æˆ˜èƒœ ${enemy.name}ï¼è·å¾— ${enemy.reward} é‡‘å¸`, 'win');

            // æ¯3å±‚æ¢å¤ä¸€ç‚¹è¡€
            if(player.floor % 3 === 0){
                player.hp = Math.min(player.maxHp, player.hp + 20);
                log('æ¯3å±‚æ¢å¤20ç”Ÿå‘½ï¼', 'heal');
            }

            enemy = null;
            document.getElementById('enemyPanel').style.display = 'none';
            player.floor++;
            updatePlayerUI();
            draw();
        }

        function gameOver(){
            log('æ¸¸æˆç»“æŸï¼', 'lose');
            alert(`ä½ åˆ°è¾¾äº†ç¬¬ ${player.floor} å±‚ï¼\nè·å¾—é‡‘å¸: ${player.money}`);
            // é‡ç½®
            player.hp = player.maxHp;
            player.floor = 1;
            player.potions = 2;
            player.money = 0;
            enemy = null;
            document.getElementById('enemyPanel').style.display = 'none';
            document.getElementById('log').innerHTML = '';
            updatePlayerUI();
            draw();
        }

        function updatePlayerUI(){
            document.getElementById('floor').textContent = player.floor;
            document.getElementById('money').textContent = player.money;
            document.getElementById('potions').textContent = player.potions;
            document.getElementById('hp').textContent = player.hp;
            document.getElementById('maxHp').textContent = player.maxHp;
            document.getElementById('hpBar').style.width = (player.hp/player.maxHp*100)+'%';
        }

        function updateEnemyUI(){
            if(!enemy) return;
            document.getElementById('enemyName').textContent = enemy.name;
            document.getElementById('enemyHp').textContent = Math.max(0, enemy.hp);
            document.getElementById('enemyMaxHp').textContent = enemy.maxHp;
            document.getElementById('enemyHpBar').style.width = (enemy.hp/enemy.maxHp*100)+'%';
        }

        function log(msg, type=''){
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            entry.textContent = msg;
            logDiv.insertBefore(entry, logDiv.firstChild);
            while(logDiv.children.length > 10) logDiv.removeChild(logDiv.lastChild);
        }

        // å¼€å§‹æ¸¸æˆ
        spawnEnemy();
        draw();
    </script>
</body>
</html>
